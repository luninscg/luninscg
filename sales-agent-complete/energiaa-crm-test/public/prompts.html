<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Energiaa CRM - Controle de Prompts IA</title>
    
    <!-- CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/theme/monokai.min.css" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #2c5aa0;
            --secondary-color: #f8b500;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --dark-color: #343a40;
            --light-color: #f8f9fa;
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-secondary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-success: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-danger: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            --shadow-light: 0 2px 10px rgba(0,0,0,0.1);
            --shadow-medium: 0 4px 20px rgba(0,0,0,0.15);
            --shadow-heavy: 0 8px 30px rgba(0,0,0,0.2);
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        .container-fluid {
            padding: 20px;
        }

        .prompt-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            box-shadow: var(--shadow-medium);
            padding: 30px;
            margin-bottom: 30px;
        }

        .prompt-card {
            background: white;
            border-radius: 15px;
            box-shadow: var(--shadow-light);
            transition: all 0.3s ease;
            border: none;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .prompt-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }

        .prompt-card-header {
            padding: 20px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .prompt-card-body {
            padding: 20px;
        }

        .prompt-status {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .status-active { background-color: var(--success-color); }
        .status-inactive { background-color: var(--danger-color); }
        .status-testing { background-color: var(--warning-color); animation: pulse 2s infinite; }
        .status-draft { background-color: var(--info-color); }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .prompt-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow-light);
            text-align: center;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-medium);
        }

        .metric-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
            margin: 0 auto 15px;
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--dark-color);
            margin-bottom: 5px;
        }

        .metric-label {
            color: #6c757d;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-custom {
            border-radius: 25px;
            padding: 10px 25px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
        }

        .btn-primary-custom {
            background: var(--gradient-primary);
            border: none;
            color: white;
        }

        .btn-primary-custom:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .btn-success-custom {
            background: var(--gradient-success);
            border: none;
            color: white;
        }

        .btn-danger-custom {
            background: var(--gradient-danger);
            border: none;
            color: white;
        }

        .prompt-editor {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow-light);
            margin-bottom: 30px;
        }

        .CodeMirror {
            border-radius: 10px;
            border: 1px solid #e9ecef;
            font-size: 14px;
            height: 300px;
        }

        .prompt-variables {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .variable-tag {
            background: var(--gradient-primary);
            color: white;
            padding: 4px 8px;
            border-radius: 15px;
            font-size: 0.8rem;
            margin: 2px;
            display: inline-block;
            cursor: pointer;
        }

        .prompt-test-panel {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow-light);
        }

        .test-input {
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            border: none;
            resize: vertical;
            min-height: 120px;
        }

        .test-output {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            min-height: 120px;
            border: 1px solid #e9ecef;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
        }

        .performance-chart {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--shadow-light);
            margin-bottom: 20px;
        }

        .version-history {
            max-height: 400px;
            overflow-y: auto;
        }

        .version-item {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 10px;
            border-left: 4px solid var(--primary-color);
            transition: all 0.3s ease;
        }

        .version-item:hover {
            background: #e9ecef;
            transform: translateX(5px);
        }

        .version-item.active {
            border-left-color: var(--success-color);
            background: #d4edda;
        }

        .prompt-categories {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .category-chip {
            background: #e9ecef;
            border: none;
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .category-chip.active {
            background: var(--gradient-primary);
            color: white;
        }

        .modal-custom .modal-content {
            border-radius: 15px;
            border: none;
            box-shadow: var(--shadow-heavy);
        }

        .modal-custom .modal-header {
            background: var(--gradient-primary);
            color: white;
            border-radius: 15px 15px 0 0;
        }

        .tab-content {
            background: white;
            border-radius: 0 15px 15px 15px;
            padding: 25px;
            box-shadow: var(--shadow-light);
        }

        .nav-tabs {
            border: none;
        }

        .nav-tabs .nav-link {
            border: none;
            border-radius: 15px 15px 0 0;
            background: #f8f9fa;
            color: var(--dark-color);
            margin-right: 5px;
            transition: all 0.3s ease;
        }

        .nav-tabs .nav-link.active {
            background: white;
            color: var(--primary-color);
            box-shadow: var(--shadow-light);
        }

        .effectiveness-meter {
            background: #e9ecef;
            border-radius: 10px;
            height: 20px;
            overflow: hidden;
            position: relative;
        }

        .effectiveness-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.3s ease;
            position: relative;
        }

        .effectiveness-fill.excellent {
            background: linear-gradient(90deg, #28a745, #20c997);
        }

        .effectiveness-fill.good {
            background: linear-gradient(90deg, #ffc107, #fd7e14);
        }

        .effectiveness-fill.poor {
            background: linear-gradient(90deg, #dc3545, #e83e8c);
        }

        .prompt-analytics {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .container-fluid {
                padding: 10px;
            }
            
            .prompt-header {
                padding: 20px;
            }
            
            .metric-value {
                font-size: 1.5rem;
            }
            
            .prompt-analytics {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <div class="prompt-header animate__animated animate__fadeInDown">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="mb-2">
                        <i class="fas fa-brain text-primary me-3"></i>
                        Controle de Prompts IA
                    </h1>
                    <p class="text-muted mb-0">Gerenciamento inteligente e otimização de prompts para máxima efetividade</p>
                </div>
                <div class="col-md-4 text-end">
                    <button class="btn btn-primary-custom btn-custom me-2" onclick="createNewPrompt()">
                        <i class="fas fa-plus me-2"></i>Novo Prompt
                    </button>
                    <button class="btn btn-success-custom btn-custom" onclick="analyzeAllPrompts()">
                        <i class="fas fa-chart-line me-2"></i>Análise
                    </button>
                </div>
            </div>
        </div>

        <!-- Prompt Metrics -->
        <div class="prompt-metrics animate__animated animate__fadeInUp">
            <div class="metric-card">
                <div class="metric-icon" style="background: var(--gradient-success);">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="metric-value" id="active-prompts">12</div>
                <div class="metric-label">Prompts Ativos</div>
            </div>
            <div class="metric-card">
                <div class="metric-icon" style="background: var(--gradient-primary);">
                    <i class="fas fa-percentage"></i>
                </div>
                <div class="metric-value" id="avg-effectiveness">87%</div>
                <div class="metric-label">Efetividade Média</div>
            </div>
            <div class="metric-card">
                <div class="metric-icon" style="background: var(--gradient-secondary);">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="metric-value" id="avg-response-time">1.2s</div>
                <div class="metric-label">Tempo Médio</div>
            </div>
            <div class="metric-card">
                <div class="metric-icon" style="background: var(--gradient-danger);">
                    <i class="fas fa-fire"></i>
                </div>
                <div class="metric-value" id="daily-usage">2.4k</div>
                <div class="metric-label">Uso Diário</div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="row">
            <!-- Prompt List -->
            <div class="col-md-8">
                <div class="prompt-editor">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Prompts Disponíveis</h5>
                        <div class="prompt-categories">
                            <button class="category-chip active" data-category="all">Todos</button>
                            <button class="category-chip" data-category="qualification">Qualificação</button>
                            <button class="category-chip" data-category="response">Resposta</button>
                            <button class="category-chip" data-category="analysis">Análise</button>
                            <button class="category-chip" data-category="custom">Customizado</button>
                        </div>
                    </div>

                    <div id="prompts-container">
                        <!-- Lead Qualification Prompt -->
                        <div class="prompt-card" data-category="qualification">
                            <div class="prompt-card-header">
                                <div>
                                    <h6 class="mb-1">
                                        <span class="prompt-status status-active"></span>
                                        Qualificação de Leads
                                    </h6>
                                    <small class="text-muted">Analisa e qualifica leads automaticamente</small>
                                </div>
                                <div>
                                    <span class="badge bg-success me-2">94% efetivo</span>
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-primary" onclick="editPrompt('lead-qualification')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-outline-success" onclick="testPrompt('lead-qualification')">
                                            <i class="fas fa-play"></i>
                                        </button>
                                        <button class="btn btn-outline-info" onclick="viewMetrics('lead-qualification')">
                                            <i class="fas fa-chart-bar"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="prompt-card-body">
                                <div class="effectiveness-meter mb-3">
                                    <div class="effectiveness-fill excellent" style="width: 94%"></div>
                                </div>
                                <div class="row">
                                    <div class="col-3 text-center">
                                        <small class="text-muted">Usos</small>
                                        <div class="fw-bold">1,247</div>
                                    </div>
                                    <div class="col-3 text-center">
                                        <small class="text-muted">Sucesso</small>
                                        <div class="fw-bold text-success">94%</div>
                                    </div>
                                    <div class="col-3 text-center">
                                        <small class="text-muted">Tempo</small>
                                        <div class="fw-bold">0.8s</div>
                                    </div>
                                    <div class="col-3 text-center">
                                        <small class="text-muted">Versão</small>
                                        <div class="fw-bold">v2.1</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- WhatsApp Response Prompt -->
                        <div class="prompt-card" data-category="response">
                            <div class="prompt-card-header">
                                <div>
                                    <h6 class="mb-1">
                                        <span class="prompt-status status-active"></span>
                                        Resposta WhatsApp
                                    </h6>
                                    <small class="text-muted">Gera respostas personalizadas para WhatsApp</small>
                                </div>
                                <div>
                                    <span class="badge bg-warning me-2">78% efetivo</span>
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-primary" onclick="editPrompt('whatsapp-response')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-outline-success" onclick="testPrompt('whatsapp-response')">
                                            <i class="fas fa-play"></i>
                                        </button>
                                        <button class="btn btn-outline-info" onclick="viewMetrics('whatsapp-response')">
                                            <i class="fas fa-chart-bar"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="prompt-card-body">
                                <div class="effectiveness-meter mb-3">
                                    <div class="effectiveness-fill good" style="width: 78%"></div>
                                </div>
                                <div class="row">
                                    <div class="col-3 text-center">
                                        <small class="text-muted">Usos</small>
                                        <div class="fw-bold">3,891</div>
                                    </div>
                                    <div class="col-3 text-center">
                                        <small class="text-muted">Sucesso</small>
                                        <div class="fw-bold text-warning">78%</div>
                                    </div>
                                    <div class="col-3 text-center">
                                        <small class="text-muted">Tempo</small>
                                        <div class="fw-bold">1.4s</div>
                                    </div>
                                    <div class="col-3 text-center">
                                        <small class="text-muted">Versão</small>
                                        <div class="fw-bold">v1.8</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Sentiment Analysis Prompt -->
                        <div class="prompt-card" data-category="analysis">
                            <div class="prompt-card-header">
                                <div>
                                    <h6 class="mb-1">
                                        <span class="prompt-status status-testing"></span>
                                        Análise de Sentimento
                                    </h6>
                                    <small class="text-muted">Analisa o sentimento das mensagens recebidas</small>
                                </div>
                                <div>
                                    <span class="badge bg-info me-2">Em teste</span>
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-primary" onclick="editPrompt('sentiment-analysis')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-outline-success" onclick="testPrompt('sentiment-analysis')">
                                            <i class="fas fa-play"></i>
                                        </button>
                                        <button class="btn btn-outline-info" onclick="viewMetrics('sentiment-analysis')">
                                            <i class="fas fa-chart-bar"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="prompt-card-body">
                                <div class="effectiveness-meter mb-3">
                                    <div class="effectiveness-fill good" style="width: 82%"></div>
                                </div>
                                <div class="row">
                                    <div class="col-3 text-center">
                                        <small class="text-muted">Usos</small>
                                        <div class="fw-bold">156</div>
                                    </div>
                                    <div class="col-3 text-center">
                                        <small class="text-muted">Sucesso</small>
                                        <div class="fw-bold text-success">82%</div>
                                    </div>
                                    <div class="col-3 text-center">
                                        <small class="text-muted">Tempo</small>
                                        <div class="fw-bold">0.9s</div>
                                    </div>
                                    <div class="col-3 text-center">
                                        <small class="text-muted">Versão</small>
                                        <div class="fw-bold">v0.3</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Lead Scoring Prompt -->
                        <div class="prompt-card" data-category="analysis">
                            <div class="prompt-card-header">
                                <div>
                                    <h6 class="mb-1">
                                        <span class="prompt-status status-active"></span>
                                        Pontuação de Lead
                                    </h6>
                                    <small class="text-muted">Calcula score de qualidade do lead</small>
                                </div>
                                <div>
                                    <span class="badge bg-success me-2">91% efetivo</span>
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-primary" onclick="editPrompt('lead-scoring')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-outline-success" onclick="testPrompt('lead-scoring')">
                                            <i class="fas fa-play"></i>
                                        </button>
                                        <button class="btn btn-outline-info" onclick="viewMetrics('lead-scoring')">
                                            <i class="fas fa-chart-bar"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="prompt-card-body">
                                <div class="effectiveness-meter mb-3">
                                    <div class="effectiveness-fill excellent" style="width: 91%"></div>
                                </div>
                                <div class="row">
                                    <div class="col-3 text-center">
                                        <small class="text-muted">Usos</small>
                                        <div class="fw-bold">892</div>
                                    </div>
                                    <div class="col-3 text-center">
                                        <small class="text-muted">Sucesso</small>
                                        <div class="fw-bold text-success">91%</div>
                                    </div>
                                    <div class="col-3 text-center">
                                        <small class="text-muted">Tempo</small>
                                        <div class="fw-bold">1.1s</div>
                                    </div>
                                    <div class="col-3 text-center">
                                        <small class="text-muted">Versão</small>
                                        <div class="fw-bold">v1.5</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Prompt Analytics & Test Panel -->
            <div class="col-md-4">
                <div class="prompt-test-panel">
                    <ul class="nav nav-tabs" id="promptTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="test-tab" data-bs-toggle="tab" data-bs-target="#test" type="button" role="tab">
                                <i class="fas fa-flask me-2"></i>Teste
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="analytics-tab" data-bs-toggle="tab" data-bs-target="#analytics" type="button" role="tab">
                                <i class="fas fa-chart-line me-2"></i>Analytics
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="versions-tab" data-bs-toggle="tab" data-bs-target="#versions" type="button" role="tab">
                                <i class="fas fa-history me-2"></i>Versões
                            </button>
                        </li>
                    </ul>
                    <div class="tab-content" id="promptTabContent">
                        <div class="tab-pane fade show active" id="test" role="tabpanel">
                            <h6 class="mb-3">Teste de Prompt</h6>
                            <div class="mb-3">
                                <label class="form-label">Prompt Selecionado</label>
                                <select class="form-select" id="selectedPrompt">
                                    <option value="lead-qualification">Qualificação de Leads</option>
                                    <option value="whatsapp-response">Resposta WhatsApp</option>
                                    <option value="sentiment-analysis">Análise de Sentimento</option>
                                    <option value="lead-scoring">Pontuação de Lead</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Entrada de Teste</label>
                                <textarea class="test-input form-control" id="testInput" placeholder="Digite aqui o texto para testar o prompt...">Olá, tenho interesse em energia solar para minha casa. Minha conta de luz vem R$ 450 por mês. Vocês fazem financiamento?</textarea>
                            </div>
                            <button class="btn btn-primary-custom btn-custom w-100 mb-3" onclick="runPromptTest()">
                                <i class="fas fa-play me-2"></i>Executar Teste
                            </button>
                            <div class="mb-3">
                                <label class="form-label">Resultado</label>
                                <div class="test-output" id="testOutput">Clique em "Executar Teste" para ver o resultado...</div>
                            </div>
                            <div class="row">
                                <div class="col-6">
                                    <small class="text-muted">Tempo de Resposta</small>
                                    <div class="fw-bold" id="responseTime">-</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Tokens Usados</small>
                                    <div class="fw-bold" id="tokensUsed">-</div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="analytics" role="tabpanel">
                            <h6 class="mb-3">Performance Analytics</h6>
                            <div class="performance-chart">
                                <canvas id="performanceChart" width="300" height="200"></canvas>
                            </div>
                            <div class="prompt-analytics">
                                <div>
                                    <h6>Taxa de Sucesso</h6>
                                    <div class="effectiveness-meter mb-2">
                                        <div class="effectiveness-fill excellent" style="width: 87%"></div>
                                    </div>
                                    <small class="text-muted">87% nos últimos 30 dias</small>
                                </div>
                                <div>
                                    <h6>Tempo Médio</h6>
                                    <div class="text-center">
                                        <div class="metric-value" style="font-size: 1.5rem;">1.2s</div>
                                        <small class="text-success">↓ 15% vs mês anterior</small>
                                    </div>
                                </div>
                            </div>
                            <div class="mt-3">
                                <h6>Métricas Detalhadas</h6>
                                <div class="row">
                                    <div class="col-6 mb-2">
                                        <small class="text-muted">Precisão</small>
                                        <div class="fw-bold">94.2%</div>
                                    </div>
                                    <div class="col-6 mb-2">
                                        <small class="text-muted">Recall</small>
                                        <div class="fw-bold">89.7%</div>
                                    </div>
                                    <div class="col-6 mb-2">
                                        <small class="text-muted">F1-Score</small>
                                        <div class="fw-bold">91.9%</div>
                                    </div>
                                    <div class="col-6 mb-2">
                                        <small class="text-muted">Latência P95</small>
                                        <div class="fw-bold">2.1s</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane fade" id="versions" role="tabpanel">
                            <h6 class="mb-3">Histórico de Versões</h6>
                            <div class="version-history">
                                <div class="version-item active">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <strong>v2.1 (Atual)</strong>
                                        <small class="text-muted">2 dias atrás</small>
                                    </div>
                                    <p class="mb-2">Melhorias na detecção de intenção de compra e otimização de tokens</p>
                                    <div class="d-flex justify-content-between">
                                        <span class="badge bg-success">94% efetivo</span>
                                        <button class="btn btn-outline-primary btn-sm" onclick="viewVersionDiff('2.1')">
                                            <i class="fas fa-eye"></i> Ver
                                        </button>
                                    </div>
                                </div>
                                <div class="version-item">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <strong>v2.0</strong>
                                        <small class="text-muted">1 semana atrás</small>
                                    </div>
                                    <p class="mb-2">Refatoração completa com foco em personalização</p>
                                    <div class="d-flex justify-content-between">
                                        <span class="badge bg-warning">89% efetivo</span>
                                        <div>
                                            <button class="btn btn-outline-info btn-sm me-1" onclick="revertToVersion('2.0')">
                                                <i class="fas fa-undo"></i>
                                            </button>
                                            <button class="btn btn-outline-primary btn-sm" onclick="viewVersionDiff('2.0')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="version-item">
                                    <div class="d-flex justify-content-between align-items-center mb-2">
                                        <strong>v1.9</strong>
                                        <small class="text-muted">2 semanas atrás</small>
                                    </div>
                                    <p class="mb-2">Ajustes na linguagem e tom de comunicação</p>
                                    <div class="d-flex justify-content-between">
                                        <span class="badge bg-secondary">85% efetivo</span>
                                        <div>
                                            <button class="btn btn-outline-info btn-sm me-1" onclick="revertToVersion('1.9')">
                                                <i class="fas fa-undo"></i>
                                            </button>
                                            <button class="btn btn-outline-primary btn-sm" onclick="viewVersionDiff('1.9')">
                                                <i class="fas fa-eye"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Prompt Editor Modal -->
    <div class="modal fade modal-custom" id="promptEditorModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Editor de Prompt</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="mb-3">
                                <label class="form-label">Nome do Prompt</label>
                                <input type="text" class="form-control" id="promptName" placeholder="Nome do prompt">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Categoria</label>
                                <select class="form-select" id="promptCategory">
                                    <option value="qualification">Qualificação</option>
                                    <option value="response">Resposta</option>
                                    <option value="analysis">Análise</option>
                                    <option value="custom">Customizado</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Conteúdo do Prompt</label>
                                <textarea id="promptContent" class="form-control" rows="15" placeholder="Digite o conteúdo do prompt aqui..."></textarea>
                            </div>
                            <div class="prompt-variables">
                                <h6>Variáveis Disponíveis</h6>
                                <p class="text-muted mb-2">Clique nas variáveis para inserir no prompt:</p>
                                <span class="variable-tag" onclick="insertVariable('{{cliente.nome}}')">{cliente.nome}</span>
                                <span class="variable-tag" onclick="insertVariable('{{cliente.telefone}}')">{cliente.telefone}</span>
                                <span class="variable-tag" onclick="insertVariable('{{cliente.consumo}}')">{cliente.consumo}</span>
                                <span class="variable-tag" onclick="insertVariable('{{mensagem.texto}}')">{mensagem.texto}</span>
                                <span class="variable-tag" onclick="insertVariable('{{mensagem.sentimento}}')">{mensagem.sentimento}</span>
                                <span class="variable-tag" onclick="insertVariable('{{contexto.historico}}')">{contexto.historico}</span>
                                <span class="variable-tag" onclick="insertVariable('{{sistema.data}}')">{sistema.data}</span>
                                <span class="variable-tag" onclick="insertVariable('{{sistema.hora}}')">{sistema.hora}</span>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <h6>Configurações Avançadas</h6>
                            <div class="mb-3">
                                <label class="form-label">Temperatura</label>
                                <input type="range" class="form-range" id="temperature" min="0" max="1" step="0.1" value="0.7">
                                <small class="text-muted">Criatividade: <span id="temperatureValue">0.7</span></small>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Max Tokens</label>
                                <input type="number" class="form-control" id="maxTokens" value="150" min="50" max="4000">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Top P</label>
                                <input type="range" class="form-range" id="topP" min="0" max="1" step="0.1" value="0.9">
                                <small class="text-muted">Diversidade: <span id="topPValue">0.9</span></small>
                            </div>
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="enableFallback" checked>
                                    <label class="form-check-label" for="enableFallback">
                                        Fallback Automático
                                    </label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="enableLogging" checked>
                                    <label class="form-check-label" for="enableLogging">
                                        Log de Execução
                                    </label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Timeout (segundos)</label>
                                <input type="number" class="form-control" id="timeout" value="30" min="5" max="120">
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-warning" onclick="testCurrentPrompt()">Testar</button>
                    <button type="button" class="btn btn-success" onclick="savePrompt()">Salvar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/6.65.7/mode/javascript/javascript.min.js"></script>
    
    <script>
        // Prompt Management System
        class PromptManager {
            constructor() {
                this.prompts = new Map();
                this.currentPrompt = null;
                this.performanceChart = null;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.initializeCharts();
                this.loadPrompts();
                this.updateMetrics();
            }

            setupEventListeners() {
                // Category filters
                document.querySelectorAll('.category-chip').forEach(chip => {
                    chip.addEventListener('click', (e) => {
                        document.querySelectorAll('.category-chip').forEach(c => c.classList.remove('active'));
                        e.target.classList.add('active');
                        this.filterPrompts(e.target.dataset.category);
                    });
                });

                // Temperature and Top P sliders
                document.getElementById('temperature').addEventListener('input', (e) => {
                    document.getElementById('temperatureValue').textContent = e.target.value;
                });

                document.getElementById('topP').addEventListener('input', (e) => {
                    document.getElementById('topPValue').textContent = e.target.value;
                });

                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch(e.key) {
                            case 'n':
                                e.preventDefault();
                                this.createNewPrompt();
                                break;
                            case 't':
                                e.preventDefault();
                                this.runPromptTest();
                                break;
                            case 's':
                                e.preventDefault();
                                if (document.getElementById('promptEditorModal').classList.contains('show')) {
                                    this.savePrompt();
                                }
                                break;
                        }
                    }
                });
            }

            loadPrompts() {
                const samplePrompts = [
                    {
                        id: 'lead-qualification',
                        name: 'Qualificação de Leads',
                        category: 'qualification',
                        content: `Você é um especialista em qualificação de leads para energia solar. Analise a mensagem do cliente e determine:\n\n1. Nível de interesse (Alto/Médio/Baixo)\n2. Capacidade financeira (estimada)\n3. Urgência da necessidade\n4. Próximos passos recomendados\n\nMensagem do cliente: {{mensagem.texto}}\nHistórico: {{contexto.historico}}\n\nResponda em formato JSON com os campos: interesse, capacidade_financeira, urgencia, proximos_passos, score (0-100).`,
                        effectiveness: 94,
                        usage: 1247,
                        avgTime: 0.8,
                        version: 'v2.1',
                        status: 'active'
                    },
                    {
                        id: 'whatsapp-response',
                        name: 'Resposta WhatsApp',
                        category: 'response',
                        content: `Você é um consultor especializado em energia solar da Energiaa. Responda de forma amigável, profissional e persuasiva.\n\nContexto do cliente:\n- Nome: {{cliente.nome}}\n- Consumo mensal: {{cliente.consumo}}\n- Histórico: {{contexto.historico}}\n\nMensagem recebida: {{mensagem.texto}}\nSentimento detectado: {{mensagem.sentimento}}\n\nDiretrizes:\n- Use linguagem acessível\n- Seja específico sobre benefícios\n- Inclua call-to-action\n- Mantenha tom consultivo\n- Máximo 200 palavras`,
                        effectiveness: 78,
                        usage: 3891,
                        avgTime: 1.4,
                        version: 'v1.8',
                        status: 'active'
                    },
                    {
                        id: 'sentiment-analysis',
                        name: 'Análise de Sentimento',
                        category: 'analysis',
                        content: `Analise o sentimento da mensagem do cliente e classifique em:\n\n- POSITIVO: Cliente interessado, satisfeito ou entusiasmado\n- NEUTRO: Cliente informativo, questionando ou neutro\n- NEGATIVO: Cliente insatisfeito, resistente ou irritado\n\nMensagem: {{mensagem.texto}}\n\nRetorne apenas:\n{\n  "sentimento": "POSITIVO|NEUTRO|NEGATIVO",\n  "confianca": 0.95,\n  "emocoes": ["interesse", "curiosidade"],\n  "intensidade": "alta|media|baixa"\n}`,
                        effectiveness: 82,
                        usage: 156,
                        avgTime: 0.9,
                        version: 'v0.3',
                        status: 'testing'
                    },
                    {
                        id: 'lead-scoring',
                        name: 'Pontuação de Lead',
                        category: 'analysis',
                        content: `Calcule o score do lead baseado nos critérios:\n\n1. Interesse demonstrado (0-25 pontos)\n2. Capacidade financeira (0-25 pontos)\n3. Urgência da necessidade (0-25 pontos)\n4. Fit com produto (0-25 pontos)\n\nDados do cliente:\n- Mensagem: {{mensagem.texto}}\n- Consumo: {{cliente.consumo}}\n- Histórico: {{contexto.historico}}\n\nRetorne:\n{\n  "score_total": 85,\n  "interesse": 22,\n  "capacidade": 20,\n  "urgencia": 18,\n  "fit_produto": 25,\n  "classificacao": "HOT|WARM|COLD",\n  "justificativa": "Explicação do score"\n}`,
                        effectiveness: 91,
                        usage: 892,
                        avgTime: 1.1,
                        version: 'v1.5',
                        status: 'active'
                    }
                ];

                samplePrompts.forEach(prompt => {
                    this.prompts.set(prompt.id, prompt);
                });
            }

            filterPrompts(category) {
                const cards = document.querySelectorAll('.prompt-card');
                cards.forEach(card => {
                    if (category === 'all' || card.dataset.category === category) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            }

            editPrompt(promptId) {
                const prompt = this.prompts.get(promptId);
                if (!prompt) return;

                this.currentPrompt = promptId;
                
                document.getElementById('promptName').value = prompt.name;
                document.getElementById('promptCategory').value = prompt.category;
                document.getElementById('promptContent').value = prompt.content;
                
                const modal = new bootstrap.Modal(document.getElementById('promptEditorModal'));
                modal.show();
            }

            createNewPrompt() {
                this.currentPrompt = null;
                
                document.getElementById('promptName').value = '';
                document.getElementById('promptCategory').value = 'custom';
                document.getElementById('promptContent').value = '';
                
                const modal = new bootstrap.Modal(document.getElementById('promptEditorModal'));
                modal.show();
            }

            savePrompt() {
                const name = document.getElementById('promptName').value;
                const category = document.getElementById('promptCategory').value;
                const content = document.getElementById('promptContent').value;
                
                if (!name || !content) {
                    this.showNotification('Nome e conteúdo são obrigatórios', 'warning');
                    return;
                }
                
                const promptId = this.currentPrompt || this.generateId();
                const prompt = {
                    id: promptId,
                    name,
                    category,
                    content,
                    effectiveness: 0,
                    usage: 0,
                    avgTime: 0,
                    version: 'v1.0',
                    status: 'draft'
                };
                
                this.prompts.set(promptId, prompt);
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('promptEditorModal'));
                modal.hide();
                
                this.showNotification('Prompt salvo com sucesso!', 'success');
                this.refreshPromptList();
            }

            async testPrompt(promptId) {
                const prompt = this.prompts.get(promptId);
                if (!prompt) return;
                
                // Switch to test tab and set prompt
                document.getElementById('test-tab').click();
                document.getElementById('selectedPrompt').value = promptId;
                
                this.showNotification('Prompt selecionado para teste', 'info');
            }

            async runPromptTest() {
                const promptId = document.getElementById('selectedPrompt').value;
                const testInput = document.getElementById('testInput').value;
                
                if (!testInput.trim()) {
                    this.showNotification('Digite um texto para testar', 'warning');
                    return;
                }
                
                const prompt = this.prompts.get(promptId);
                if (!prompt) return;
                
                // Show loading
                document.getElementById('testOutput').textContent = 'Processando...';
                document.getElementById('responseTime').textContent = 'Calculando...';
                document.getElementById('tokensUsed').textContent = 'Calculando...';
                
                const startTime = Date.now();
                
                // Simulate API call
                await this.sleep(1000 + Math.random() * 2000);
                
                const endTime = Date.now();
                const responseTime = ((endTime - startTime) / 1000).toFixed(2);
                
                // Generate mock response based on prompt type
                let mockResponse = '';
                switch (promptId) {
                    case 'lead-qualification':
                        mockResponse = `{\n  "interesse": "Alto",\n  "capacidade_financeira": "Média-Alta",\n  "urgencia": "Média",\n  "proximos_passos": "Agendar visita técnica",\n  "score": 78\n}`;
                        break;
                    case 'whatsapp-response':
                        mockResponse = `Olá! Que ótimo saber do seu interesse em energia solar! 🌞\n\nCom um consumo de R$ 450/mês, você pode economizar até 95% na sua conta de luz. Sim, trabalhamos com financiamento em até 120x!\n\nGostaria de agendar uma visita técnica gratuita para calcularmos sua economia exata?`;
                        break;
                    case 'sentiment-analysis':
                        mockResponse = `{\n  "sentimento": "POSITIVO",\n  "confianca": 0.89,\n  "emocoes": ["interesse", "curiosidade"],\n  "intensidade": "alta"\n}`;
                        break;
                    case 'lead-scoring':
                        mockResponse = `{\n  "score_total": 78,\n  "interesse": 20,\n  "capacidade": 18,\n  "urgencia": 15,\n  "fit_produto": 25,\n  "classificacao": "WARM",\n  "justificativa": "Cliente demonstra interesse genuíno e capacidade financeira adequada"\n}`;
                        break;
                    default:
                        mockResponse = 'Resposta gerada com sucesso para o prompt customizado.';
                }
                
                document.getElementById('testOutput').textContent = mockResponse;
                document.getElementById('responseTime').textContent = `${responseTime}s`;
                document.getElementById('tokensUsed').textContent = Math.floor(Math.random() * 200 + 50);
                
                this.showNotification('Teste executado com sucesso!', 'success');
            }

            viewMetrics(promptId) {
                // Switch to analytics tab
                document.getElementById('analytics-tab').click();
                this.showNotification('Métricas carregadas', 'info');
            }

            analyzeAllPrompts() {
                this.showNotification('Análise completa iniciada...', 'info');
                
                // Simulate analysis
                setTimeout(() => {
                    this.showNotification('Análise concluída! Verifique o painel de analytics.', 'success');
                }, 2000);
            }

            insertVariable(variable) {
                const textarea = document.getElementById('promptContent');
                const start = textarea.selectionStart;
                const end = textarea.selectionEnd;
                const text = textarea.value;
                
                textarea.value = text.substring(0, start) + variable + text.substring(end);
                textarea.focus();
                textarea.setSelectionRange(start + variable.length, start + variable.length);
            }

            revertToVersion(version) {
                if (confirm(`Tem certeza que deseja reverter para a versão ${version}?`)) {
                    this.showNotification(`Revertido para versão ${version}`, 'success');
                }
            }

            viewVersionDiff(version) {
                this.showNotification(`Visualizando diferenças da versão ${version}`, 'info');
            }

            testCurrentPrompt() {
                const content = document.getElementById('promptContent').value;
                if (!content.trim()) {
                    this.showNotification('Digite o conteúdo do prompt primeiro', 'warning');
                    return;
                }
                
                this.showNotification('Teste do prompt atual executado', 'success');
            }

            updateMetrics() {
                let totalActive = 0;
                let totalEffectiveness = 0;
                let totalTime = 0;
                let totalUsage = 0;
                
                this.prompts.forEach(prompt => {
                    if (prompt.status === 'active') {
                        totalActive++;
                        totalEffectiveness += prompt.effectiveness;
                        totalTime += prompt.avgTime;
                        totalUsage += prompt.usage;
                    }
                });
                
                document.getElementById('active-prompts').textContent = totalActive;
                document.getElementById('avg-effectiveness').textContent = totalActive > 0 ? 
                    Math.round(totalEffectiveness / totalActive) + '%' : '0%';
                document.getElementById('avg-response-time').textContent = totalActive > 0 ? 
                    (totalTime / totalActive).toFixed(1) + 's' : '0s';
                document.getElementById('daily-usage').textContent = this.formatNumber(totalUsage);
            }

            initializeCharts() {
                const ctx = document.getElementById('performanceChart').getContext('2d');
                this.performanceChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun'],
                        datasets: [{
                            label: 'Efetividade (%)',
                            data: [78, 82, 85, 87, 89, 91],
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102, 126, 234, 0.1)',
                            tension: 0.4
                        }, {
                            label: 'Tempo Resposta (s)',
                            data: [1.8, 1.6, 1.4, 1.3, 1.2, 1.1],
                            borderColor: '#f093fb',
                            backgroundColor: 'rgba(240, 147, 251, 0.1)',
                            tension: 0.4,
                            yAxisID: 'y1'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                type: 'linear',
                                display: true,
                                position: 'left',
                                min: 0,
                                max: 100
                            },
                            y1: {
                                type: 'linear',
                                display: true,
                                position: 'right',
                                min: 0,
                                max: 3,
                                grid: {
                                    drawOnChartArea: false,
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top'
                            }
                        }
                    }
                });
            }

            refreshPromptList() {
                // Refresh the prompt cards display
                this.updateMetrics();
            }

            generateId() {
                return 'prompt_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }

            formatNumber(num) {
                if (num >= 1000) {
                    return (num / 1000).toFixed(1) + 'k';
                }
                return num.toString();
            }

            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }

            showNotification(message, type = 'info') {
                // Create notification element
                const notification = document.createElement('div');
                notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
                notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
                notification.innerHTML = `
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                `;
                
                document.body.appendChild(notification);
                
                // Auto remove after 5 seconds
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 5000);
            }
        }

        // Global functions for onclick handlers
        let promptManager;

        function createNewPrompt() {
            promptManager.createNewPrompt();
        }

        function editPrompt(promptId) {
            promptManager.editPrompt(promptId);
        }

        function testPrompt(promptId) {
            promptManager.testPrompt(promptId);
        }

        function viewMetrics(promptId) {
            promptManager.viewMetrics(promptId);
        }

        function analyzeAllPrompts() {
            promptManager.analyzeAllPrompts();
        }

        function runPromptTest() {
            promptManager.runPromptTest();
        }

        function savePrompt() {
            promptManager.savePrompt();
        }

        function testCurrentPrompt() {
            promptManager.testCurrentPrompt();
        }

        function insertVariable(variable) {
            promptManager.insertVariable(variable);
        }

        function revertToVersion(version) {
            promptManager.revertToVersion(version);
        }

        function viewVersionDiff(version) {
            promptManager.viewVersionDiff(version);
        }

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            promptManager = new PromptManager();
            
            // Add some animations
            const cards = document.querySelectorAll('.prompt-card');
            cards.forEach((card, index) => {
                card.style.animationDelay = `${index * 0.1}s`;
                card.classList.add('animate__animated', 'animate__fadeInUp');
            });
            
            // Update metrics every 30 seconds
            setInterval(() => {
                promptManager.updateMetrics();
            }, 30000);
        });

        // Real-time updates simulation
        function simulateRealTimeUpdates() {
            setInterval(() => {
                // Simulate metric updates
                const elements = {
                    'daily-usage': () => {
                        const current = parseInt(document.getElementById('daily-usage').textContent.replace('k', '')) * 1000;
                        return promptManager.formatNumber(current + Math.floor(Math.random() * 10));
                    },
                    'avg-effectiveness': () => {
                        const current = parseInt(document.getElementById('avg-effectiveness').textContent.replace('%', ''));
                        const change = Math.floor(Math.random() * 3) - 1; // -1, 0, or 1
                        return Math.max(0, Math.min(100, current + change)) + '%';
                    },
                    'avg-response-time': () => {
                        const current = parseFloat(document.getElementById('avg-response-time').textContent.replace('s', ''));
                        const change = (Math.random() * 0.2) - 0.1; // -0.1 to 0.1
                        return Math.max(0.1, current + change).toFixed(1) + 's';
                    }
                };
                
                // Randomly update one metric
                const keys = Object.keys(elements);
                const randomKey = keys[Math.floor(Math.random() * keys.length)];
                const element = document.getElementById(randomKey);
                if (element) {
                    element.textContent = elements[randomKey]();
                }
            }, 5000);
        }

        // Start real-time updates
        setTimeout(simulateRealTimeUpdates, 2000);
    </script>
</body>
</html>